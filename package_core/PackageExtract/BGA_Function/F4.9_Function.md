# F4.9 参数提取函数关系

本节聚焦尺寸参数计算阶段（F4.9），梳理核心函数及其依赖关系，便于后续调整参数提取逻辑。

## 数据入口：`finalize_pairs`
- 位置：`package_core/PackageExtract/common_pipeline.py`
- 作用：整合 OCR 文本、标尺长度与尺寸线副本，调用 `get_better_data_2` 过滤/补全配对，输出清洗后的 OCR 列表与尺寸线集（`yolox_pairs_*`）。
- 依赖字段：
  - OCR 数据：`top/bottom/side/detailed_ocr_data`。
  - 引线补齐结果：`*_yolox_pairs_length`。
  - 尺寸线副本：`*_yolox_pairs_copy`。
- 产物：更新的 OCR 数据与 `yolox_pairs_top/bottom/side/detailed`，供参数推断使用。

## 主计算：`compute_qfp_parameters`
- 位置：`package_core/PackageExtract/common_pipeline.py`
- 输入：`finalize_pairs` 产出的 OCR 与尺寸线结果，以及封装边框 `top/bottom_border`。
- 核心步骤：
  1. **PIN 阵列尺寸**：`get_serial(top_serial_numbers_data, bottom_serial_numbers_data)` 根据序号框差值统计推断 `nx/ny`。
  2. **主体长宽估计**：`get_QFP_body(...)` 将尺寸线引线与实体边框对齐，寻找符合误差的长宽候选，必要时互补 top/bottom 结果。
  3. **候选组装与筛选**：
     - `get_QFP_parameter_list(...)` 把各视图 OCR 归入参数槽位（D/E/A/A1/e/b/θ/L 等），并记录候选数量。
     - `resort_parameter_list_2(...)` 若某参数只有唯一候选则标记确定，同时从其他参数候选中剔除重复值，循环收敛。
     - `get_QFP_high(...)`、`get_QFP_pitch(...)` 在候选数量>1时用于专门筛选高度与引脚间距候选。
  4. **返回**：参数列表与 `nx/ny`。

## 结果封装：`get_BGA_parameter_data`
- 位置：`package_core/PackageExtract/function_tool.py`
- 作用：将 `compute_qfp_parameters` 返回的参数结构映射到固定长度的 BGA 参数表（19 行），当前填充 PIN 间距、实体尺寸、高度等关键字段，供 `run_f4_pipeline` 直接返回。
- 行列计数 `nx/ny` 目前未写入表格，但可在后续扩展中使用。

## 依赖脉络总结
1. `finalize_pairs` 清洗配对结果，确保尺寸线/OCR 数据一致性。
2. `compute_qfp_parameters` 调用 `get_serial` → `get_QFP_body` → `get_QFP_parameter_list` →（可选）`get_QFP_high`/`get_QFP_pitch`/`resort_parameter_list_2` 完成参数推导。
3. `get_BGA_parameter_data` 将推导结果转换为最终参数列表。
