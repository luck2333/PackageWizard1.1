# F4.7 尺寸线匹配阶段 side 视图数据缺失分析

## 现象回顾
- 第二步后处理（YOLOX）侧视图 `side` 的 SVTR 输出中包含两个有效框：`1.10±0.10` 与 `0.10MAX 0.35±0.05`。
- 进入第三步 OpenCV 尺寸线匹配后，控制台先打印 `side_pairs_data []`，随后只出现了 `A2` 相关的匹配日志，再往后 `side` 视图在“经过第三步后处理”输出中变为空。

## 代码路径
- 侧视图的匹配入口在 `MPD` 函数：先调用 `match_pairs_data`，再调用 `match_pairs_data_angle`，然后打印 `side_pairs_data`。【F:package_core/PackageExtract/get_pairs_data_present5_test.py†L1504-L1560】
- `match_pairs_data` 的主流程：
  - 如果标尺线 `pairs` 为空，`matched_data` 始终为 0，`new_ocr` 会继承传入的全部标注，随后在第 5.4 步把 `new_ocr` 直接追加到 `right_matched_pairs`，最后通过 `result` 返回，不应该主动清空标注。【F:package_core/PackageExtract/get_pairs_data_present5_test.py†L2902-L3337】
  - 这意味着只有当传入的 `ocr` 已经是空列表，或在函数内部被替换成其他视图的标注时，返回值才会为空。
- `match_pairs_data_angle` 只针对 `Absolutely == 'angle'` 的标注做配对，其余标注会沿用与上面相同的 5.4 回填逻辑，同样不会删除非 angle 的尺寸数据。【F:package_core/PackageExtract/get_pairs_data_present5_test.py†L3355-L3762】

## 可疑原因定位
- 日志显示在 side 阶段竟然打印了 `A2` 的匹配信息，而在侧视图输入中并不存在该标注，说明传入 `match_pairs_data` 的 `side_ocr_data` 已被前序步骤污染（例如复用了其他视图的标注列表或被外部覆盖为新对象）。
- 由于两处匹配函数在标尺线为空时都包含回填逻辑，唯一能导致空输出的路径是：
  1. `MPD` 调用前 `side_ocr_data` 已为空；或
  2. `side_ocr_data` 在调用间被误指向了其他视图的标注，使得 deduplicate 阶段删除了原始 side 标注。
- 建议在进入 `MPD` 之前对 `side_ocr_data` 做深拷贝并打印标注列表，以确认是否在匹配函数之前发生了数据错位；同时在 `match_pairs_data` 开头记录传入的 `ocr` 长度和每条 `ocr['location']`，以快速锁定污染来源。
